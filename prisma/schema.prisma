generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model PokerTournament {
  id              Int       @id @default(autoincrement())
  name            String?   @map("Name") @db.VarChar(255)
  uid             String?   @map("UID") @db.VarChar(255)
  bustTime        BigInt?   @map("Bust_Time")
  bustRound       Int?      @map("Bust_Round")
  hitman          String?   @map("Hitman") @db.VarChar(255)
  Hitman_UID      String?   @db.VarChar(255)
  placement       Int?      @map("Placement")
  knockouts       Int?      @map("Knockouts")
  startPoints     Int?      @map("Start_Points")
  hitPoints       Int?      @map("Hit_Points")
  placementPoints Int?      @map("Placement_Points")
  cash            Int?      @map("Cash")
  place           String?   @map("Place") @db.VarChar(50)
  season          String?   @map("Season") @db.VarChar(100)
  venue           String?   @map("Venue") @db.VarChar(255)
  totalPoints     Int?      @map("Total_Points")
  playerScore     Float?    @map("Player_Score") @db.Float
  fileName        String?   @map("File_name") @db.VarChar(255)
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp(0)
  gameDate        DateTime? @map("game_date") @db.Date
  gameUid         String?   @map("game_uid") @db.VarChar(100)

  @@index([Hitman_UID], map: "idx_hitman_uid")
  @@map("poker_tournaments")
}

model Player {
  uid               String          @id
  name              String
  nickname          String?
  created_at        DateTime        @default(now())
  updated_at        DateTime        @default(now()) @updatedAt
  email             String?         @unique @db.VarChar(255)
  email_verified_at DateTime?       @db.Timestamp(0)
  last_login_at     DateTime?       @db.Timestamp(0)
  password_hash     String?         @db.VarChar(255)
  photo_url         String?         @db.VarChar(500)
  favorite_hand     String?         @db.VarChar(100)
  favorite_pro      String?         @db.VarChar(100)
  isAdmin           Boolean         @default(false)
  bonus_points      bonus_points[]
  password_resets   PasswordReset[]
  PlayerBadge       PlayerBadge[]

  @@index([email], map: "idx_player_email")
  @@index([isAdmin], map: "idx_player_isAdmin")
  @@map("players")
}

model PasswordReset {
  id         String    @id @default(uuid()) @db.VarChar(36)
  player_uid String
  token_hash String    @unique @db.VarChar(255)
  expires_at DateTime  @db.Timestamp(0)
  used_at    DateTime? @db.Timestamp(0)
  created_at DateTime  @default(now()) @db.Timestamp(0)
  player     Player    @relation(fields: [player_uid], references: [uid], onDelete: Cascade, onUpdate: Restrict)

  @@index([player_uid], map: "idx_reset_player_uid")
  @@index([expires_at], map: "idx_reset_expires")
  @@map("password_resets")
}

model Badge {
  badge_id          String        @id @db.VarChar(36)
  quote             String        @db.Text
  short_description String        @db.VarChar(100)
  long_description  String        @db.Text
  criteria          String        @db.VarChar(100)
  category          String        @db.VarChar(30)
  rarity            Int           @db.TinyInt
  icon              String?       @db.VarChar(255)
  enabled           Boolean?      @default(true)
  created_at        DateTime      @default(now()) @db.DateTime(0)
  updated_at        DateTime      @default(now()) @updatedAt @db.DateTime(0)
  tier              String?       @db.TinyText
  players           PlayerBadge[]

  @@map("badges")
}

model PlayerBadge {
  id          Int       @id @default(autoincrement())
  player_uid  String
  badge_id    String    @db.VarChar(36)
  earned_at   DateTime  @db.DateTime(0)
  quarter     String?   @db.VarChar(7)
  year        Int?
  game_id     String?   @db.VarChar(255)
  expiration  DateTime? @map("expiration") @db.Date
  description String?   @map("description") @db.Text
  CreatedAt   DateTime? @default(now()) @db.DateTime(0)
  player      Player    @relation(fields: [player_uid], references: [uid], onUpdate: Restrict, map: "player_badges_ibfk_1")
  badge       Badge     @relation(fields: [badge_id], references: [badge_id], onUpdate: Restrict, map: "player_badges_ibfk_2")

  @@unique([player_uid, badge_id, quarter, year], map: "player_uid")
  @@index([badge_id], map: "badge_id")
  @@index([expiration], map: "idx_player_badges_expiration")
  @@map("player_badges")
}

model poker_tournaments_test {
  id               Int       @id @default(autoincrement())
  Name             String?   @db.VarChar(255)
  UID              String?   @db.VarChar(255)
  Bust_Time        BigInt?
  Bust_Round       Int?
  Hitman           String?   @db.VarChar(255)
  Placement        Int?
  Knockouts        Int?
  Start_Points     Int?
  Hit_Points       Int?
  Placement_Points Int?
  Cash             Int?
  Place            String?   @db.VarChar(50)
  Season           String?   @db.VarChar(100)
  Venue            String?   @db.VarChar(255)
  Total_Points     Int?
  Player_Score     Float?    @db.Float
  File_name        String?   @db.VarChar(255)
  created_at       DateTime  @default(now()) @db.Timestamp(0)
  game_date        DateTime? @db.Date
  game_uid         String?   @db.VarChar(100)
}

model TournamentDraft {
  id                      Int                     @id @default(autoincrement())
  tournament_date         DateTime                @db.Date
  tournament_time         DateTime?               @db.Time(0)
  director_name           String                  @db.VarChar(255)
  venue                   String                  @db.VarChar(255)
  start_points            Int                     @default(0)
  status                  TournamentDraftStatus   @default(in_progress)
  created_by              String?                 @db.VarChar(255)
  created_at              DateTime                @default(now()) @db.Timestamp(0)
  updated_at              DateTime                @default(now()) @updatedAt @db.Timestamp(0)
  game_uid                String?                 @db.VarChar(100)
  file_name               String?                 @db.VarChar(255)
  blind_schedule          String?                 @default("standard") @db.VarChar(50)
  custom_blind_levels     String?                 @db.LongText
  check_in_token          String?                 @db.VarChar(36)
  timer_current_level     Int?                    @default(1)
  timer_remaining_seconds Int?                    @default(1200)
  timer_is_running        Boolean?                @default(false)
  timer_is_paused         Boolean?                @default(false)
  timer_last_updated      DateTime                @default(now()) @db.Timestamp(0)
  TournamentAuditLog      TournamentAuditLog[]
  games                   games[]
  players                 TournamentDraftPlayer[]
  tournament_feed_items   tournament_feed_items[]

  @@index([status], map: "idx_status")
  @@index([tournament_date], map: "idx_tournament_date")
  @@index([game_uid], map: "idx_game_uid")
  @@index([check_in_token], map: "idx_check_in_token")
  @@map("tournament_drafts")
}

model TournamentDraftPlayer {
  id                  Int                                @id @default(autoincrement())
  tournament_draft_id Int
  player_name         String                             @db.VarChar(255)
  player_uid          String?                            @db.VarChar(255)
  status              tournament_draft_players_status?   @default(active)
  is_new_player       Boolean                            @default(false)
  hitman_name         String?                            @db.VarChar(255)
  hitman_uid          String?                            @db.VarChar(255)
  knockedout_at       DateTime?                          @db.DateTime(0)
  ko_position         Int?
  placement           Int?
  created_at          DateTime                           @default(now()) @db.Timestamp(0)
  updated_at          DateTime                           @default(now()) @updatedAt @db.Timestamp(0)
  added_by            tournament_draft_players_added_by? @default(admin)
  checked_in_at       DateTime?                          @db.Timestamp(0)
  player_nickname     String?                            @db.VarChar(255)
  tournament_draft    TournamentDraft                    @relation(fields: [tournament_draft_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "tournament_draft_players_ibfk_1")

  @@unique([tournament_draft_id, player_name], map: "unique_player_per_tournament")
  @@unique([tournament_draft_id, placement], map: "unique_placement_per_tournament")
  @@index([tournament_draft_id], map: "idx_tournament_draft_id")
  @@index([player_uid], map: "idx_player_uid")
  @@index([placement], map: "idx_placement")
  @@map("tournament_draft_players")
}

model bonus_points {
  id         Int      @id @default(autoincrement())
  player_uid String   @db.VarChar(255)
  points     Int
  reason     String   @db.VarChar(255)
  category   String?  @default("promotional") @db.VarChar(100)
  awarded_by String?  @db.VarChar(255)
  awarded_at DateTime @default(now()) @db.Timestamp(0)
  season     String?  @db.VarChar(100)
  notes      String?  @db.Text
  players    Player   @relation(fields: [player_uid], references: [uid], onUpdate: Restrict, map: "bonus_points_ibfk_1")

  @@index([awarded_at], map: "idx_awarded_date")
  @@index([player_uid, season], map: "idx_player_season")
}

model tournament_feed_items {
  id                     Int                              @id @default(autoincrement())
  tournament_draft_id    Int
  item_type              tournament_feed_items_item_type?
  author_uid             String?                          @db.VarChar(50)
  author_name            String?                          @db.VarChar(255)
  message_text           String?                          @db.Text
  eliminated_player_name String?                          @db.VarChar(255)
  hitman_name            String?                          @db.VarChar(255)
  ko_position            Int?
  created_at             DateTime?                        @default(now()) @db.Timestamp(0)
  photo_filename         String?                          @db.VarChar(255)
  tournament_drafts      TournamentDraft                  @relation(fields: [tournament_draft_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "tournament_feed_items_ibfk_1")

  @@index([tournament_draft_id, created_at(sort: Desc)], map: "idx_tournament_created")
}

model feed_item_reactions {
  id                  Int                               @id @default(autoincrement())
  feed_item_id        String                            @db.VarChar(255)
  tournament_draft_id Int
  user_uid            String                            @db.VarChar(50)
  reaction_type       feed_item_reactions_reaction_type
  count               Int                               @default(1)
  created_at          DateTime?                         @default(now()) @db.Timestamp(0)
  updated_at          DateTime?                         @default(now()) @db.Timestamp(0)

  @@unique([feed_item_id, user_uid, reaction_type], map: "uq_reaction")
  @@index([feed_item_id], map: "idx_feed_item")
  @@index([user_uid, tournament_draft_id], map: "idx_user_tournament")
}

model TournamentAuditLog {
  id                 Int                                @id @default(autoincrement())
  tournament_id      Int
  action_type        String                             @db.VarChar(50)
  action_category    TournamentAuditLog_action_category
  actor_id           Int?
  actor_name         String?                            @db.VarChar(100)
  target_player_id   Int?
  target_player_name String?                            @db.VarChar(100)
  previous_value     String?                            @db.LongText
  new_value          String?                            @db.LongText
  metadata           String?                            @db.LongText
  ip_address         String?                            @db.VarChar(45)
  created_at         DateTime?                          @default(now()) @db.DateTime(0)
  tournament_drafts  TournamentDraft                    @relation(fields: [tournament_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "TournamentAuditLog_ibfk_1")

  @@index([action_type], map: "idx_action_type")
  @@index([created_at], map: "idx_created_at")
  @@index([tournament_id], map: "idx_tournament_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model appearances {
  game_id      Int
  player_id    Int
  placement    Int?
  points       Int?       @default(0)
  player_score Float?     @db.Float
  created      DateTime   @default(now()) @db.Timestamp(0)
  modified     DateTime   @default(now()) @db.Timestamp(0)
  games        games      @relation(fields: [game_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_appearances_game")
  players_v2   players_v2 @relation(fields: [player_id], references: [id], onUpdate: Restrict, map: "fk_appearances_player")

  @@id([game_id, player_id])
  @@index([player_id], map: "idx_appearances_player")
}

model games {
  id                  Int              @id @default(autoincrement())
  uid                 String           @unique(map: "uq_games_uid") @db.VarChar(50)
  league_id           Int              @default(1)
  venue_id            Int
  date                DateTime         @db.Date
  time                DateTime?        @db.Time(0)
  director            String?          @db.VarChar(255)
  bonus_points        Int              @default(0)
  season              String?          @db.VarChar(100)
  tournament_draft_id Int?
  created             DateTime         @default(now()) @db.Timestamp(0)
  modified            DateTime         @default(now()) @db.Timestamp(0)
  appearances         appearances[]
  tournament_drafts   TournamentDraft? @relation(fields: [tournament_draft_id], references: [id], onUpdate: Restrict, map: "fk_games_draft")
  leagues             leagues          @relation(fields: [league_id], references: [id], onUpdate: Restrict, map: "fk_games_league")
  venues              venues           @relation(fields: [venue_id], references: [id], onUpdate: Restrict, map: "fk_games_venue")
  knockouts           knockouts[]

  @@index([date], map: "idx_games_date")
  @@index([tournament_draft_id], map: "idx_games_draft")
  @@index([league_id], map: "idx_games_league")
  @@index([season], map: "idx_games_season")
  @@index([venue_id], map: "idx_games_venue")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model knockouts {
  id                                      Int         @id @default(autoincrement())
  game_id                                 Int
  hitman                                  Int?
  victim                                  Int
  time_ko                                 DateTime?   @db.Timestamp(0)
  time_created                            DateTime    @default(now()) @db.Timestamp(0)
  modified                                DateTime    @default(now()) @db.Timestamp(0)
  games                                   games       @relation(fields: [game_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_knockouts_game")
  players_v2_knockouts_hitmanToplayers_v2 players_v2? @relation("knockouts_hitmanToplayers_v2", fields: [hitman], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_knockouts_hitman")
  players_v2_knockouts_victimToplayers_v2 players_v2  @relation("knockouts_victimToplayers_v2", fields: [victim], references: [id], onUpdate: Restrict, map: "fk_knockouts_victim")

  @@index([game_id], map: "idx_knockouts_game")
  @@index([hitman], map: "idx_knockouts_hitman")
  @@index([victim], map: "idx_knockouts_victim")
}

model leagues {
  id              Int          @id @default(autoincrement())
  name            String       @unique(map: "uq_leagues_name") @db.VarChar(255)
  slug            String       @unique(map: "uq_leagues_slug") @db.VarChar(255)
  is_active       Boolean      @default(true)
  league_settings String?      @db.LongText
  created         DateTime     @default(now()) @db.Timestamp(0)
  modified        DateTime     @default(now()) @db.Timestamp(0)
  games           games[]
  players_v2      players_v2[]
  venues          venues[]
}

model players_v2 {
  id                                     Int           @id @default(autoincrement())
  uid                                    String        @unique(map: "uq_players_uid") @db.VarChar(50)
  league_id                              Int           @default(1)
  first_name                             String?       @db.VarChar(255)
  last_name                              String?       @db.VarChar(255)
  nickname                               String?       @db.VarChar(255)
  email                                  String?       @unique(map: "uq_players_email") @db.VarChar(255)
  email_verified_at                      DateTime?     @db.Timestamp(0)
  last_login_at                          DateTime?     @db.Timestamp(0)
  password_hash                          String?       @db.VarChar(255)
  photo_url                              String?       @db.VarChar(500)
  favorite_hand                          String?       @db.VarChar(100)
  favorite_pro                           String?       @db.VarChar(100)
  created                                DateTime      @default(now()) @db.Timestamp(0)
  modified                               DateTime      @default(now()) @db.Timestamp(0)
  isAdmin                                Boolean       @default(false)
  appearances                            appearances[]
  knockouts_knockouts_hitmanToplayers_v2 knockouts[]   @relation("knockouts_hitmanToplayers_v2")
  knockouts_knockouts_victimToplayers_v2 knockouts[]   @relation("knockouts_victimToplayers_v2")
  leagues                                leagues       @relation(fields: [league_id], references: [id], onUpdate: Restrict, map: "fk_players_league")

  @@index([league_id], map: "idx_players_league")
  @@index([isAdmin], map: "idx_players_v2_isAdmin")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model venues {
  id          Int      @id @default(autoincrement())
  league_id   Int      @default(1)
  name        String   @unique(map: "uq_venues_name") @db.VarChar(255)
  address     String?  @db.VarChar(300)
  is_active   Boolean  @default(true)
  cutoff_time Int?
  created     DateTime @default(now()) @db.Timestamp(0)
  modified    DateTime @default(now()) @db.Timestamp(0)
  games       games[]
  leagues     leagues  @relation(fields: [league_id], references: [id], onUpdate: Restrict, map: "fk_venues_league")

  @@index([league_id], map: "idx_venues_league")
}

enum TournamentDraftStatus {
  in_progress
  finalized
  integrated
}

enum tournament_draft_players_status {
  active
  knockedout
}

enum feed_item_reactions_reaction_type {
  heart
  diamond
  club
  spade
}

enum tournament_draft_players_added_by {
  admin
  self_checkin
  kiosk
}

enum TournamentAuditLog_action_category {
  ADMIN
  PLAYER
  SYSTEM
}

enum tournament_feed_items_item_type {
  knockout
  message
  checkin
  system
  td_message
  photo
}
